<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://www.dropbox.com/scl/fi/rda7ohwdqojn7q2goa66i/iconpkmbw.png?rlkey=w4amn3yc2nhewlzz2v136qfo4&st=63n5zpvx&raw=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Share+Tech&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    
    <title>POKÉMON: Virtual Links!</title>
   <style>
        :root {font-size: 16px;}
        img {user-select: none;}
        body {background: #f8f8f8;margin: 0;padding: 0;font-family: 'Bungee', cursive;display: flex;flex-direction: row;height: 100vh;overflow: hidden;}
        .title-font {font-family: 'Press Start 2P', cursive;}
        body::before {content: '';position: fixed;top: 0;left: 0;width: 50%;height: 100%;background-color: #111;background-image: linear-gradient(45deg, #222 25%, transparent 25%, transparent 75%, #222 75%), linear-gradient(45deg, #222 25%, transparent 25%, transparent 75%, #222 75%);background-size: 66px 66px;background-position: 0 0, 30px 30px;z-index: -2;}
        body::after {content: '';position: fixed;top: 0;right: 0;width: 50%;height: 100%;background-color: #f0f0f0;background-image: linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%), linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size: 66px 66px;background-position: 0 0, 30px 30px;z-index: -2;}
        .left-container {width: 49.5%;height: 100vh;display: flex;flex-direction: column;overflow: hidden;}
        .right-container {width: 50.5%;height: 100vh;overflow: hidden;padding: 0;box-sizing: border-box;}
        .content {font-family: 'Share Tech', sans-serif;line-height: 1.6;font-size: 1.1rem;border: none;border-radius: 0;padding: 0;background: rgba(255,255,255, 0.75);display: flex;flex-direction: column;min-height: 100%;position: relative;overflow: hidden;}
        .content p {margin-bottom: 1rem;text-align: justify;}
        .content-bottom {margin-top: auto;text-align: center;padding: 1rem;margin-bottom: 1rem;}
        .content-bottom img {max-width: 5rem;height: auto;display: block;margin: 0 auto;}
        .right-container::-webkit-scrollbar {width: 7px;background: white;}
        .right-container::-webkit-scrollbar-thumb {background: gray;}
        .right-container::-webkit-scrollbar-thumb:hover {background: black;}
        header {background-color: rgba(0, 0, 0, 0.88);color: white;padding: 1.5rem;display: flex;align-items: center;justify-content: space-between;width: 100%;box-sizing: border-box;flex-shrink: 0;margin-top: 0.5%;}
        header img {width: 2.25rem;height: auto;margin-top: -2vh;}
        @keyframes gradientRepeat {0% {background-position: 0% 0%;}25% {background-position: 100% 0%;}50% {background-position: 100% 100%;}75% {background-position: 0% 100%;}100% {background-position: 0% 0%;}}
        .cape {width: 99.5%;padding: 3.1rem 0;text-align: center;background: linear-gradient(135deg, #001F3F, #003366, #663399, #8A2BE2, #7FFFD4, #00CED1, #20B2AA, #3CB371, #2E8B57, #006400);display: flex;justify-content: center;align-items: center;background-size: 200% 200%;animation: gradientRepeat 7s linear infinite;flex-shrink: 0;}
        .cape img {max-width: 5rem;height: auto;filter: contrast(40%) brightness(40%);animation: rotate 4s linear infinite;display: block;transition: filter 0.3s ease;}
        .cape img:hover {filter: contrast(40%) brightness(100%);}
        @keyframes rotate {0% {transform: rotate(0deg);}50% {transform: rotate(-200deg);}70% {transform: rotate(200deg);}100% {transform: rotate(0deg);}}
        footer {background: linear-gradient(to bottom, #000000, #111111, #222222);color: white;padding: 3rem;text-align: center;border-bottom: 1.5rem double #222;width: 100%;flex-grow: 1;box-sizing: border-box;display: flex;flex-direction: column;justify-content: center;margin-bottom: 1px;}
        .button-frame {display: flex;justify-content: space-between;align-items: flex-start;background: none;padding: 0.1rem 1.8rem 0.1rem 0.1rem;width: 100%;flex-shrink: 0;}
        .main-menu {display: flex;flex-direction: column;align-items: start;user-select: none;width: 58%;}
        .main-buttons {width: 100%;text-decoration: none;color: white;background-color: rgba(255,255,255, 0.4);border: 0.4rem groove white;border-right-style: ridge;border-bottom-style: ridge;font-family: 'Press Start 2P', sans-serif;font-size: 0.7rem;padding: 0.75rem 1rem;margin: 5px 0;cursor: pointer;box-sizing: border-box;}
        .main-buttons:hover {border-color: cyan;border-right-style: ridge;border-bottom-style: ridge;border-radius: 0.25rem;}
        .footer-button-container {display: flex;justify-content: center;margin-top: 1rem;flex-wrap: wrap;}
        .pokebutton {width: 3.1rem;height: 3.1rem;margin: 0 1rem;padding: 0;background-color: transparent;border-radius: 50%;border: 0.4rem groove white;border-right-style: ridge;border-bottom-style: ridge;overflow: hidden;cursor: pointer;}
        .pokebutton img {width: 100%;height: 100%;border-radius: 50%;object-fit: cover;}
        .pokebutton img:hover {filter: invert(100%);}
        #date {font-size: 0.7rem;user-select: none;font-family: 'Share Tech', sans-serif;}
        #clock {font-size: 0.9rem;user-select: none;font-family: 'Share Tech', sans-serif;}
        .indicador {display: none;position: fixed;top: 0;right: 0;background-color: #222;padding: 0.7rem 0.5rem 0.5rem 0.7rem;width: 30%;text-align: center;color: white;font-family: 'Share Tech';font-size: 1.1rem;z-index: 999999;border-radius: 0.5rem 0 0 0.5rem;}
        @media (max-width: 768px) {body {flex-direction: column;height: auto;overflow: hidden;}body::before {background-color: #f0f0f0;background-image: linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%), linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);}body::after {top: 0;height: 100%;}.left-container {display: none;}.right-container {width: 100%;height: 100vh;flex-grow: 1;position: absolute;top: 0;left: 0;right: 0;bottom: 0;padding: 0;margin-top: 0;border: none;box-sizing: border-box;}.button-frame {position: sticky;top: 0;z-index: 10;background-color: rgba(0, 0, 0, 0.95);width: 100%;box-sizing: border-box;padding: 0.6rem 1rem;justify-content: space-between;}header {margin-top: 0;padding: 1rem;}header img {margin-top: 0;}.cape {padding: 2rem 0;}.cape img {max-width: 4rem;}footer {padding: 1.5rem;border-bottom-width: 1rem;margin-bottom: 0;}.main-buttons {font-size: 0.6rem;padding: 0.5rem 0.75rem;border-width: 0.3rem;}.pokebutton {width: 2.5rem;height: 2.5rem;margin: 0 0.5rem;border-width: 0.3rem;}.content {font-size: 1rem;padding: 0;min-height: auto;height: 100vh;display: flex;flex-direction: column;}.content-bottom {position: static;margin-top: auto;margin-bottom: 1rem;}.content-bottom img {max-width: 4rem;}.indicador {width: 50%;left: auto;right: 0;}.main-menu {width: 68%;}.footer-button-container {flex-wrap: nowrap;justify-content: space-around;}}
        @media (max-width: 480px) {.pokebutton {width: 2rem;height: 2rem;margin: 0 0.25rem;}.footer-button-container {margin-top: 0.5rem;}.content {padding: 0.5rem;padding-bottom: 4rem;}}
        .down-arrow {display: flex;justify-content: center;margin-bottom: 1px;}
        .down-arrow img {max-width: 3rem;height: auto;}

        #whiteboard { margin:0; padding:0; box-sizing:border-box; user-select:none; -webkit-user-select:none; -moz-user-select:none; }
        .pages-section, #pages-section { display: none!important; }
        .content { background:#000000; color:#ffffff; font-family:'Press Start 2P', cursive; overflow:hidden; display:flex; touch-action: manipulation; } 
        #sidebar { width:60px; overflow-x:hidden; background:#000000; border:4px solid black; display:flex; flex-direction:column; align-items:flex-start; padding:10px; height:100%; transition:width 0.4s cubic-bezier(0.25,0.8,0.25,1); overflow-y:auto; position:absolute; left:0; top:0; z-index:100; }
        #sidebar.expanded { width:280px; }
        #sidebar:not(.expanded) .category, #sidebar:not(.expanded) .section-label, #sidebar:not(.expanded) select, #sidebar:not(.expanded) #color-palette { display:none; }
        #sidebar::-webkit-scrollbar { width:6px; }
        #sidebar::-webkit-scrollbar-track { background:#000000; }
        #sidebar::-webkit-scrollbar-thumb { background:#666666; }
        #sidebar::-webkit-scrollbar-thumb:hover { background:#000000; }
        #hamburger { background:transparent!important; color:#ffffff!important; border:none; width:50px; height:50px; font-size:28px; margin:10px; cursor:pointer; transition:color 0.3s; }
        #hamburger:hover { color: gray!important; box-shadow:none!important;}
        #hamburger.expanded:hover { color:#ff0000!important; }
        #sidebar .category { display:grid; grid-template-columns:1.25fr 1.25fr; gap:2px; padding:0px; width:100%; margin-bottom: 12.5%; }
        #sidebar .sidebar-button-container { display:flex; flex-direction:column; align-items:center; }
        #sidebar button { background:#ffffff; color:#000000; border:2px solid #000000; width:60px; height:60px; font-size:24px; margin:4px; cursor:pointer; transition:all 0.3s; }
        #sidebar button:hover { transform:scale(1.1); background:#aaaaaa; box-shadow:0 0 15px rgba(255,255,255,0.5); }
        #sidebar button.active { background:#aaaaaa; }
        #sidebar .button-label { font-size:9px; margin-top:2px; color:#ffffff; text-align:center; white-space:nowrap; }
        #canvas-container { flex:1; margin-left:60px; background: rgba(255,255,255, 0.7); position:relative; transition:margin-left 0.4s cubic-bezier(0.25,0.8,0.25,1); overflow-y: hidden; overflow-x: auto; }
        #canvas { width:100%; height:100%; background: rgba(255,255,255, 0.7); overflow-y: hidden; overflow-x: auto; }
        #sidebar select, #sidebar input[type="range"] { background: rgba(255,255,255, 0.7); color:#000000; border:none; padding:12px; margin:12px; width:95%; }
        .section-label { font-size:12px; color:#ffffff; margin-top:1.5rem; text-align:left; -webkit-text-stroke:1px #000000; text-shadow:2px 2px 0 #000000, -2px -2px 0 #000000, 2px -2px 0 #000000, -2px 2px 0 #000000; }
        #color-palette { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; padding:10px; width:100%; }
        #color-palette .swatch { width:50%; aspect-ratio:1/1; border-radius:50%; cursor:pointer; border:2px solid #ffffff; box-shadow:0 0 5px rgba(255,255,255,0.5); transition:border 0.3s; margin: auto; }
        #color-palette .swatch.active { border-style:groove groove ridge ridge; border-width:4px; border-color:var(--selected-color); }
        @media (max-width:480px) { #sidebar.expanded { width:100%; } #canvas-container { margin-left:0; } }
    </style>
</head>
<body>

    <div class="left-container">
        <div class="button-frame">
            <div class="main-menu">
                <a href="#" class="main-buttons">INTRO</a>
                <a href="#" class="main-buttons">ENREDO</a>
                <a href="#" class="main-buttons">AVENTURAS</a>
                <a href="#" class="main-buttons">SISTEMAS</a>
                <a href="#" class="main-buttons">CONTROLES</a>
            </div>
        </div>

        <header>
            <img src="https://www.dropbox.com/scl/fi/ll6ch6ff83v8lfb4ov08m/signalpkmbw.gif?rlkey=kzpsssn8sdfyac7oyxe4ds208&st=0tet7vai&raw=1" alt="Signal">
            <div id="date"></div>
            <div id="clock"></div>
        </header>
        
        <div class="cape">
            <img src="https://www.dropbox.com/scl/fi/480cflc155lmxpkmlwr4j/centerpkmbw.png?rlkey=leovgwbvok4anolgjdjx92dui&st=y2wu3x1a&raw=1" alt="Center">
        </div>
        
        <footer>
            <div class="down-arrow">
                <img src="https://www.dropbox.com/scl/fi/lg0rb2vflhy1tyrpr5y5s/arrow-down.gif?rlkey=pr6jtpp8y3u1qfcxglvro41vw&st=vzg7ydif&raw=1" alt="Down Arrow">
            </div>

            <div class="footer-button-container">
                <a href="#"><div class="pokebutton" id="pokedex"><img title="Pokédex" src="https://www.dropbox.com/scl/fi/83u64f6125glsj2ds8vj9/pok-dexpkmbw.png?rlkey=1q2xwmp2h1t0ua96t3oluuk8j&st=epzb8imz&raw=1" alt="Pokédex"></div></a>
                <a href="#"><div class="pokebutton" id="pokemon"><img title="Pokémon" src="https://www.dropbox.com/scl/fi/vqi3i8v1j8twlltrg54jo/pok-monpkmbw.png?rlkey=ifl8w0g436gvw5g16b60pammm&st=5gl0sp9l&raw=1" alt="Pokémon"></div></a>
                <a href="#"><div class="pokebutton" id="mochila"><img title="Mochila" src="https://www.dropbox.com/scl/fi/30y4c4hvxy6rml9txwdz0/mochilapkmbw.png?rlkey=phjrfx6ityxyk80k0b3l6l5i8&st=eq22cuey&raw=1" alt="Mochila"></div></a>
                <a href="#"><div class="pokebutton" id="mercado"><img title="Mercado" src="https://www.dropbox.com/scl/fi/n4nu7knoh265cu6ogztra/pokemartpkmbw.png?rlkey=zx4q3wp1ddpnjo7vukvzohjqe&st=20hh53k8&raw=1" alt="Mercado"></div></a>
                <a href="#"><div class="pokebutton" id="salvar"><img title="Salvar" src="https://www.dropbox.com/scl/fi/8a7fsjvrl080z7qihhsxz/salvarpkmbw.png?rlkey=h2chvobe6h0t0p6hsflvolfw5&st=egiimnn6&raw=1" alt="Salvar"></div></a>
                <a href="#"><div class="pokebutton" id="presentes"><img title="Presentes" src="https://www.dropbox.com/scl/fi/4stx69jj00x2oadq9khec/giftpkmbw.png?rlkey=9rrblgflbungunc1ymulatx53&st=lbxspee3&raw=1" alt="Presentes"></div></a>
            </div>
            
            <div class="footer-button-container">
                <a href="#"><div class="pokebutton" id="mapa"><img title="Mapa" src="https://www.dropbox.com/scl/fi/t1ka6hn45fv084ciev3zv/mapapkmbw.png?rlkey=tw6dyvf466kf6behkad683l4k&st=p72bdyb6&raw=1" alt="Mapa"></div></a>
                <a href="#"><div class="pokebutton" id="desafios"><img title="Conquistas" src="https://www.dropbox.com/scl/fi/mphot2jnzetll750y5afi/conquistaspkmbw.png?rlkey=iul0igrcxbdfyqs89w6bjhuom&st=ht6ql7av&raw=1" alt="Conquistas"></div></a>
                <a href="#"><div class="pokebutton" id="alertas"><img title="Notificações" src="https://www.dropbox.com/scl/fi/fuu2e7xqaml2hiy29cq60/notifica-espkmbw.png?rlkey=m0624n6x8rebi69egigfy10is&st=zj68h2rv&raw=1" alt="Notificações"></div></a>
                <a href="#"><div class="pokebutton" id="treinador"><img title="Treinador" src="https://www.dropbox.com/scl/fi/uq4iufoikjb62145ov0h6/treinadorpkmbw.png?rlkey=8qvvsk0u03ll0hodtc40vb6j5&st=ocgaa4bs&raw=1" alt="Treinador"></div></a>
                <a href="#"><div class="pokebutton" id="classificacao"><img title="Classificação" src="https://www.dropbox.com/scl/fi/4ljlfdglhmshse0kkffpb/classifica-opkmbw.png?rlkey=z4p57kupz6a9pp5a4kcx0c8na&st=rouspxrm&raw=1" alt="Classificação"></div></a>
                <a href="#"><div class="pokebutton" id="ovos"><img title="Ovos" src="https://www.dropbox.com/scl/fi/n1mqd7qx4bek23rgkxacm/ieggpkmbw.png?rlkey=41mw3vjhcmjipjxke1d1jfyb6&st=bez2ch7l&raw=1" alt="Ovos"></div></a>
            </div>
        </footer>
    </div>

    <div class="right-container">
        <div class="content" id="whiteboard">
            <div id="sidebar">
                <button id="hamburger"><i class="fas fa-bars"></i></button>

                <div class="section-label">Inserir</div>
                <div class="category">
                    <div class="sidebar-button-container"><button id="select-btn"><i class="fas fa-mouse-pointer"></i></button><span class="button-label">Selecionar</span></div>
                    <div class="sidebar-button-container"><button id="text-btn"><i class="fas fa-font"></i></button><span class="button-label">Inserir Texto</span></div>
                    <div class="sidebar-button-container"><button id="image-btn"><i class="fas fa-image"></i></button><span class="button-label">Imagem</span></div>
                    <div class="sidebar-button-container"><button id="bg-image-btn"><i class="fas fa-image"></i></button><span class="button-label">Fundo Img</span></div>
                </div>

                <div class="section-label">Texto</div>
                <div class="category">
                    <div class="sidebar-button-container"><button id="bold-btn"><i class="fas fa-bold"></i></button><span class="button-label">Negrito</span></div>
                    <div class="sidebar-button-container"><button id="italic-btn"><i class="fas fa-italic"></i></button><span class="button-label">Itálico</span></div>
                    <div class="sidebar-button-container"><button id="underline-btn"><i class="fas fa-underline"></i></button><span class="button-label">Sublinhado</span></div>
                    <div class="sidebar-button-container"><button id="bullet-btn"><i class="fas fa-list-ul"></i></button><span class="button-label">Tópicos</span></div>
                </div>
                <select id="font-size">
                    <option value="8">8</option><option value="10">10</option><option value="12">12</option><option value="14">14</option><option value="16">16</option><option value="18">18</option><option value="20">20</option><option value="24">24</option><option value="28">28</option><option value="32">32</option><option value="36">36</option><option value="48">48</option>
                </select>
                <select id="align-select">
                    <option value="left">Esquerda</option><option value="center">Centralizado</option><option value="right">Direita</option><option value="justify">Justificado</option>
                </select>

                <div class="section-label">Desenho</div>
                <div class="category" style="margin-top:20px;">
                    <div class="sidebar-button-container"><button id="draw-btn"><i class="fas fa-pencil-alt"></i></button><span class="button-label">Lápis</span></div>
                    <div class="sidebar-button-container"><button id="brush-btn"><i class="fas fa-paint-brush"></i></button><span class="button-label">Pincel</span></div>
                    <div class="sidebar-button-container"><button id="erase-btn"><i class="fas fa-eraser"></i></button><span class="button-label">Apagador</span></div>
                    <div class="sidebar-button-container"><button id="line-btn"><i class="fas fa-slash"></i></button><span class="button-label">Linha</span></div>
                    <div class="sidebar-button-container"><button id="rect-btn"><i class="fas fa-square"></i></button><span class="button-label">Retângulo</span></div>
                    <div class="sidebar-button-container"><button id="circle-btn"><i class="fas fa-circle"></i></button><span class="button-label">Círculo</span></div>
                    <div class="sidebar-button-container"><button id="triangle-btn"><i class="fas fa-play"></i></button><span class="button-label">Triângulo</span></div>
                </div>

                <div class="section-label">Cores</div>
                <div class="category">
                    <div class="sidebar-button-container"><button id="paint-bucket-btn"><i class="fas fa-fill-drip"></i></button><span class="button-label">Pintar</span></div>
                    <div class="sidebar-button-container"><button id="eyedropper-btn"><i class="fas fa-eye-dropper"></i></button><span class="button-label">Pegar Cor</span></div>
                </div>
                <div id="color-palette">
                    <div class="swatch" style="background:#000000" data-color="#000000"></div>
                    <div class="swatch" style="background:#ffffff" data-color="#ffffff"></div>
                    <div class="swatch" style="background:#ff0000" data-color="#ff0000"></div>
                    <div class="swatch" style="background:#00ff00" data-color="#00ff00"></div>
                    <div class="swatch" style="background:#0000ff" data-color="#0000ff"></div>
                    <div class="swatch" style="background:#ffff00" data-color="#ffff00"></div>
                    <div class="swatch" style="background:#ff00ff" data-color="#ff00ff"></div>
                    <div class="swatch" style="background:#00ffff" data-color="#00ffff"></div>
                    <div class="swatch" style="background:#ffa500" data-color="#ffa500"></div>
                    <div class="swatch" style="background:#800080" data-color="#800080"></div>
                    <div class="swatch" style="background:#008000" data-color="#008000"></div>
                    <div class="swatch" style="background:#808080" data-color="#808080"></div>
                </div>

                <div class="section-label">Ações</div>
                <div class="category">
                    <div class="sidebar-button-container"><button id="undo-btn"><i class="fas fa-undo"></i></button><span class="button-label">Desfazer</span></div>
                    <div class="sidebar-button-container"><button id="save-btn"><i class="fas fa-save"></i></button><span class="button-label">Salvar</span></div>
                    <div class="sidebar-button-container"><button id="clear-btn"><i class="fas fa-trash"></i></button><span class="button-label">Limpar</span></div>
                </div>

                <div id="pages-section">
                    <button id="new-page-btn"><i class="fas fa-plus"></i></button>
                    <select id="page-selector"></select>
                </div>
            </div>

            <div id="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <input type="file" id="image-upload" accept="image/*" style="display:none">
            <input type="file" id="bg-image-upload" accept="image/*" style="display:none">
        </div>
    </div>

    <div class="indicador">
        <p id="indicadorText"></p> 
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var titleElement = document.title;
            var intervalId;
            var repetitions = 3;
            var currentRepetition = 0;

            function startTitleAnimation() {
                var title = ": Virtual Links!";
                var index = 0;

                intervalId = setInterval(function () {
                    document.title = "POKÉMON" + title.substring(0, index);
                    index++;

                    if (index > title.length) {
                        clearInterval(intervalId);
                        setTimeout(function () {
                            currentRepetition++;

                            if (currentRepetition < repetitions) {
                                startTitleAnimation();
                            } else {
                                currentRepetition = 0;
                                setTimeout(function () {
                                    startTitleAnimation();
                                }, 1000);
                            }
                        }, 1000);
                    }
                }, 150); 
            }

            startTitleAnimation();
        });
    </script>

    <script>
        function updateClockAndDate() {
            var now = new Date();
            
            var futureDate = new Date(now.getFullYear() + 100, now.getMonth(), now.getDate());
            
            var optionsDate = { month: 'short', day: 'numeric', year: 'numeric' };
            var dateString = futureDate.toLocaleDateString('en-US', optionsDate);
            document.getElementById('date').innerText = dateString;

            var tokyoTime = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Tokyo"}));
            var hours = tokyoTime.getHours();
            var minutes = tokyoTime.getMinutes();
            var seconds = tokyoTime.getSeconds();

            hours = hours < 10 ? '0' + hours : hours;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;

            var timeString = hours + ':' + minutes + ':' + seconds;
            document.getElementById('clock').innerText = timeString;
        }

        setInterval(updateClockAndDate, 1000); 
        updateClockAndDate(); 
    </script>

    <script>
        function changeText(text) {
            var indicadorText = document.getElementById('indicadorText');
            indicadorText.innerHTML = text;

            var indicador = document.querySelector('.indicador');
            indicador.style.display = (text !== '') ? 'flex' : 'none';
        }

        function hideIndicador() {
            var indicador = document.querySelector('.indicador');
            indicador.style.display = 'none';
        }

        const buttonConfigs = [
            { id: 'pokedex', text: 'POKÉDEX' },
            { id: 'pokemon', text: 'POKÉMON' },
            { id: 'mochila', text: 'MOCHILA' },
            { id: 'mercado', text: 'MERCADO' },
            { id: 'salvar', text: 'SALVAR' },
            { id: 'presentes', text: 'PRESENTES' },
            { id: 'mapa', text: 'MAPA' },
            { id: 'desafios', text: 'CONQUISTAS' },
            { id: 'alertas', text: 'NOTIFICAÇÕES' },
            { id: 'treinador', text: 'TREINADOR' },
            { id: 'classificacao', text: 'CLASSIFICAÇÃO' },
            { id: 'ovos', text: 'OVOS' }
        ];

        buttonConfigs.forEach(config => {
            const el = document.getElementById(config.id);
            if (el) {
                el.addEventListener('mouseover', () => changeText(config.text));
                el.addEventListener('mouseout', hideIndicador);
            }
        });
    </script>

    <script>
        document.addEventListener('contextmenu', event => {
            event.preventDefault();
            document.elementFromPoint(event.clientX, event.clientY).click();
        });

        document.onkeydown = function(e) {
            if (e.ctrlKey || e.altKey || e.shiftKey) {
                return false;
            }
        };

        document.onselectstart = function() {
            return false;
        };

        document.oncopy = function() {
            return false;
        };

        document.oncut = function() {
            return false;
        };

        document.ondragstart = function() {
            return false;
        };
    </script>

    <script>
        const content = document.querySelector('.content');
        const canvas = new fabric.Canvas('canvas', { isDrawingMode: false, backgroundColor: '#ffffff', perPixelTargetFind: true });
        const canvasContainer = document.getElementById('canvas-container');
        const sidebar = document.getElementById('sidebar');
        const hamburger = document.getElementById('hamburger');

        function resizeCanvas() {
            const sidebarWidth = sidebar.classList.contains('expanded') ? 280 : 60;
            const contentRect = content.getBoundingClientRect();
            canvas.setDimensions({ width: contentRect.width - sidebarWidth, height: contentRect.height });
            canvasContainer.style.marginLeft = `${sidebarWidth}px`;
            regenerateLines();
        }

        hamburger.addEventListener('click', () => {
            sidebar.classList.toggle('expanded');
            if (sidebar.classList.contains('expanded')) {
                hamburger.innerHTML = '<i class="fas fa-times"></i>';
            } else {
                hamburger.innerHTML = '<i class="fas fa-bars"></i>';
            }
            resizeCanvas();
        });

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        fabric.IText.prototype.fontFamily = 'Press Start 2P';
        fabric.Textbox.prototype.fontFamily = 'Press Start 2P';

        const STORAGE_KEY = 'pokemon_whiteboard_state';
        let pages = [{state:[], mods:-1, bg:'#ffffff'}], currentPage=0, maxPages=30;
        let state=[], mods=-1, currentMode='select', currentColor='#000000', currentFillColor='#ffffff', currentFontSize=16, currentAlign='left', currentBrushSize=2, copiedObject=null, drawingObject=null, lastTextY=100;

        if (localStorage.getItem(STORAGE_KEY)) {
            pages = JSON.parse(localStorage.getItem(STORAGE_KEY));
            switchPage(currentPage);
        } else {
            updateState();
        }

        function saveStateToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(pages));
        }

        function updateState() {
            state = state.slice(0, mods + 1);
            const currentState = JSON.stringify(canvas.toJSON());
            state.push(currentState);
            mods += 1;
            saveStateToStorage();
        }
        canvas.on('object:added', updateState);
        canvas.on('object:modified', updateState);
        canvas.on('object:removed', updateState);
        canvas.on('path:created', updateState);

        function regenerateLines() {
            canvas.getObjects().filter(obj => obj.isBackgroundLine).forEach(obj => canvas.remove(obj));
            for (let i = 30; i < canvas.height; i += 30) {
                var line = new fabric.Line([0, i, canvas.width, i], {
                    stroke: '#ddd',
                    strokeWidth: 1,
                    selectable: false,
                    evented: false,
                    isBackgroundLine: true
                });
                canvas.add(line);
                canvas.sendToBack(line);
            }
        }

        function switchPage(pageIndex) {
            pages[currentPage].state = state;
            pages[currentPage].mods = mods;
            pages[currentPage].bg = canvas.backgroundColor || '#ffffff';
            if (canvas.backgroundImage) pages[currentPage].bgImage = canvas.backgroundImage.getSrc();

            currentPage = pageIndex;
            state = pages[currentPage].state || [];
            mods = pages[currentPage].mods || -1;
            canvas.backgroundColor = pages[currentPage].bg || '#ffffff';
            if (pages[currentPage].bgImage) {
                fabric.Image.fromURL(pages[currentPage].bgImage, (img) => {
                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), { scaleX: canvas.width / img.width, scaleY: canvas.height / img.height });
                });
            } else {
                canvas.setBackgroundImage(null, canvas.renderAll.bind(canvas));
            }
            if (state.length > 0) {
                canvas.loadFromJSON(state[mods], () => {
                    regenerateLines();
                    canvas.renderAll();
                    updateState();
                });
            } else {
                canvas.clear();
                regenerateLines();
                updateState();
            }
            updatePageSelector();
            saveStateToStorage();
        }

        function updatePageSelector() {
            const selector = document.getElementById('page-selector');
            selector.innerHTML = '';
            pages.forEach((_, i) => {
                const option = document.createElement('option');
                option.value = i;
                option.text = `Página ${i + 1}`;
                selector.add(option);
            });
            selector.value = currentPage;
        }

        document.getElementById('new-page-btn').addEventListener('click', () => {
            if (pages.length < maxPages) {
                pages.push({ state: [], mods: -1, bg: '#ffffff' });
                switchPage(pages.length - 1);
            }
        });

        document.getElementById('page-selector').addEventListener('change', (e) => switchPage(parseInt(e.target.value)));

        updatePageSelector();

        document.getElementById('font-size').addEventListener('change', (e) => {
            currentFontSize = parseInt(e.target.value);
            const activeObject = canvas.getActiveObject();
            if (activeObject && (activeObject.type === 'i-text' || activeObject.type === 'textbox')) {
                activeObject.set('fontSize', currentFontSize);
                canvas.renderAll();
                updateState();
            }
        });

        document.getElementById('align-select').addEventListener('change', (e) => {
            currentAlign = e.target.value;
            const activeObject = canvas.getActiveObject();
            if (activeObject && (activeObject.type === 'i-text' || activeObject.type === 'textbox')) {
                activeObject.set('textAlign', currentAlign);
                canvas.renderAll();
                updateState();
            }
        });

        document.querySelectorAll('.swatch').forEach(swatch => {
            swatch.addEventListener('click', () => {
                document.querySelectorAll('.swatch').forEach(s => s.classList.remove('active'));
                swatch.classList.add('active');
                swatch.style.setProperty('--selected-color', swatch.dataset.color);
                currentColor = swatch.dataset.color;
                canvas.freeDrawingBrush.color = currentColor;
                const activeObject = canvas.getActiveObject();
                if (activeObject) {
                    activeObject.set('fill', currentColor);
                    activeObject.set('stroke', currentColor);
                    canvas.renderAll();
                    updateState();
                }
            });
        });

        document.getElementById('select-btn').addEventListener('click', () => {
            currentMode = 'select';
            canvas.isDrawingMode = false;
            activateButton(document.getElementById('select-btn'));
        });

        document.getElementById('draw-btn').addEventListener('click', () => {
            currentMode = 'draw';
            canvas.freeDrawingBrush = new fabric.PencilBrush(canvas);
            canvas.isDrawingMode = true;
            canvas.freeDrawingBrush.width = currentBrushSize;
            canvas.freeDrawingBrush.color = currentColor;
            canvas.freeDrawingBrush.shadow = null;
            activateButton(document.getElementById('draw-btn'));
        });

        document.getElementById('brush-btn').addEventListener('click', () => {
            currentMode = 'brush';
            canvas.freeDrawingBrush = new fabric.PencilBrush(canvas);
            canvas.isDrawingMode = true;
            canvas.freeDrawingBrush.width = 20;
            canvas.freeDrawingBrush.color = currentColor;
            canvas.freeDrawingBrush.shadow = new fabric.Shadow({
                blur: 10,
                offsetX: 0,
                offsetY: 0,
                color: currentColor
            });
            activateButton(document.getElementById('brush-btn'));
        });

        const CustomEraserBrush = fabric.util.createClass(fabric.PencilBrush, {
            color: 'white',

            _finalizeAndAddPath: function () {
                var ctx = this.canvas.contextTop;
                this.canvas.clearContext(ctx);
                this._points.length === 0 && ctx.closePath();
                var pathData = this.convertPointsToSVGPath(this._points).join('');
                if (pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {

                    this.canvas.requestRenderAll();
                    return;
                }

                var path = this.createPath(pathData);
                path.globalCompositeOperation = 'destination-out';
                path.selectable = false;
                path.evented = false;
                path.absolutePositioned = true;

                const objects = this.canvas.getObjects();
                const eraserPaths = objects.filter(obj => obj.isEraserPath);

                if (eraserPaths.length > 0) {

                    const group = new fabric.Group(eraserPaths);
                    group.addWithUpdate(path);
                    this.canvas.remove(...eraserPaths);
                    path = group;
                }

                this.canvas.add(path);
                this.canvas.requestRenderAll();
            }
        });

        document.getElementById('erase-btn').addEventListener('click', () => {
            currentMode = 'erase';
            canvas.freeDrawingBrush = new CustomEraserBrush(canvas);
            canvas.isDrawingMode = true;
            canvas.freeDrawingBrush.width = currentBrushSize * 5;
            canvas.freeDrawingBrush.shadow = null;
            canvas.discardActiveObject();
            activateButton(document.getElementById('erase-btn'));
        });

        canvas.on('path:created', (e) => {
            if (currentMode === 'erase') {
                e.path.isEraserPath = true;
            }
        });

        function addShape(mode) {
            currentMode = mode;
            canvas.isDrawingMode = false;
            activateButton(document.getElementById(`${mode}-btn`));
        }

        document.getElementById('line-btn').addEventListener('click', () => addShape('line'));
        document.getElementById('rect-btn').addEventListener('click', () => addShape('rect'));
        document.getElementById('circle-btn').addEventListener('click', () => addShape('circle'));
        document.getElementById('triangle-btn').addEventListener('click', () => addShape('triangle'));

        let startX, startY;
        canvas.on('mouse:down', (opt) => {
            if (opt.e.button === 2) {
                currentMode = 'select';
                canvas.isDrawingMode = false;
                activateButton(document.getElementById('select-btn'));
                opt.e.preventDefault();
                return;
            }
            if (['line', 'rect', 'circle', 'triangle'].includes(currentMode)) {
                startX = opt.pointer.x;
                startY = opt.pointer.y;
                let options = {
                    stroke: currentColor,
                    strokeWidth: currentBrushSize,
                    fill: 'transparent',
                    selectable: true,
                    left: startX,
                    top: startY
                };
                if (currentMode === 'line') {
                    drawingObject = new fabric.Line([startX, startY, startX, startY], options);
                } else if (currentMode === 'rect') {
                    options.width = 0;
                    options.height = 0;
                    drawingObject = new fabric.Rect(options);
                } else if (currentMode === 'circle') {
                    options.radius = 1;
                    drawingObject = new fabric.Circle(options);
                } else if (currentMode === 'triangle') {
                    drawingObject = new fabric.Triangle({ ...options, width: 0, height: 0 });
                }
                canvas.add(drawingObject);
            } else if (currentMode === 'eyedropper') {
                const ctx = canvas.lowerCanvasEl.getContext('2d');
                const [r, g, b] = ctx.getImageData(opt.pointer.x, opt.pointer.y, 1, 1).data;
                currentColor = rgbToHex(r, g, b);
                canvas.freeDrawingBrush.color = currentColor;
                currentMode = 'select';
                activateButton(document.getElementById('select-btn'));
            } else if (currentMode === 'paint-bucket') {
                const activeObject = canvas.getActiveObject();
                if (activeObject) {
                    activeObject.set('fill', currentColor);
                } else {
                    canvas.backgroundColor = currentColor;
                    pages[currentPage].bg = currentColor;
                }
                canvas.renderAll();
                updateState();
                currentMode = 'select';
                activateButton(document.getElementById('paint-bucket-btn'));
            }
        });

        canvas.on('mouse:move', (opt) => {
            if (drawingObject) {
                const pointer = opt.pointer;
                let width = Math.abs(pointer.x - startX);
                let height = Math.abs(pointer.y - startY);
                let left = Math.min(startX, pointer.x);
                let top = Math.min(startY, pointer.y);
                if (currentMode === 'line') {
                    drawingObject.set({ x2: pointer.x, y2: pointer.y });
                } else if (currentMode === 'rect' || currentMode === 'triangle') {
                    drawingObject.set({ width, height, left, top });
                } else if (currentMode === 'circle') {
                    drawingObject.set({ radius: Math.min(width, height) / 2, left, top });
                }
                canvas.renderAll();
            }
        });

        canvas.on('mouse:up', () => {
            if (drawingObject) {
                drawingObject.set('fill', currentFillColor);
                canvas.renderAll();
                drawingObject = null;
                updateState();
                currentMode = 'select';
                activateButton(document.getElementById('select-btn'));
            }
        });

        document.getElementById('text-btn').addEventListener('click', () => {
            const text = new fabric.IText('Digite aqui', {
                left: 100,
                top: lastTextY,
                fontSize: currentFontSize,
                fill: currentColor,
                textAlign: currentAlign
            });
            canvas.add(text);
            canvas.setActiveObject(text);
            text.enterEditing();
            lastTextY += 50;
            updateState();
            currentMode = 'select';
            activateButton(document.getElementById('select-btn'));
        });

        document.getElementById('bold-btn').addEventListener('click', () => toggleSelected('fontWeight', 'bold', 'normal'));
        document.getElementById('italic-btn').addEventListener('click', () => toggleSelected('fontStyle', 'italic', 'normal'));
        document.getElementById('underline-btn').addEventListener('click', () => toggleSelected('underline', true, false));

        document.getElementById('bullet-btn').addEventListener('click', () => {
            const bulletText = new fabric.IText('• Item 1\n• Item 2', {
                left: 100,
                top: lastTextY,
                fontSize: currentFontSize,
                fill: currentColor,
                textAlign: currentAlign
            });
            canvas.add(bulletText);
            canvas.setActiveObject(bulletText);
            bulletText.enterEditing();
            lastTextY += 50;
            updateState();
            currentMode = 'select';
            activateButton(document.getElementById('select-btn'));
        });

        document.getElementById('undo-btn').addEventListener('click', () => {
            if (mods > 0) {
                mods -= 1;
                canvas.loadFromJSON(state[mods], canvas.renderAll.bind(canvas));
            }
        });

        document.getElementById('clear-btn').addEventListener('click', () => {
            canvas.clear();
            canvas.backgroundColor = '#ffffff';
            canvas.setBackgroundImage(null, canvas.renderAll.bind(canvas));
            regenerateLines();
            state = [];
            mods = -1;
            lastTextY = 100;
            updateState();
        });

        function prepareForSave() {
            const originalBgColor = canvas.backgroundColor;
            const originalBgImage = canvas.backgroundImage;
            const originalLines = [];
            const eraserItems = [];

            canvas.backgroundColor = '#ffffff';
            canvas.setBackgroundImage(null, null);

            canvas.getObjects().forEach(obj => {
                if (obj.isBackgroundLine) {
                    originalLines.push({ obj: obj, stroke: obj.stroke });
                    obj.set('stroke', '#000000');
                }
                if (obj.type === 'group') {
                    obj.forEachObject(sub => {
                        if (sub.globalCompositeOperation === 'destination-out') {
                            eraserItems.push(sub);
                            sub.globalCompositeOperation = 'source-over';
                            sub.set('stroke', '#ffffff');
                        }
                    });
                } else if (obj.globalCompositeOperation === 'destination-out') {
                    eraserItems.push(obj);
                    obj.globalCompositeOperation = 'source-over';
                    obj.set('stroke', '#ffffff');
                }
            });

            canvas.renderAll();

            return { originalBgColor, originalBgImage, originalLines, eraserItems };
        }

        function restoreAfterSave({ originalBgColor, originalBgImage, originalLines, eraserItems }) {
            canvas.backgroundColor = originalBgColor;
            canvas.setBackgroundImage(originalBgImage, canvas.renderAll.bind(canvas));

            originalLines.forEach(({ obj, stroke }) => {
                obj.set('stroke', stroke);
            });

            eraserItems.forEach(item => {
                item.globalCompositeOperation = 'destination-out';
                item.set('stroke', 'white');
            });

            canvas.renderAll();
        }

        function getContentBounds() {
            const objects = canvas.getObjects();
            if (objects.length === 0) {
                return { width: 800, height: 600 };  
            }
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            objects.forEach(obj => {
                const bounds = obj.getBoundingRect();
                minX = Math.min(minX, bounds.left);
                minY = Math.min(minY, bounds.top);
                maxX = Math.max(maxX, bounds.left + bounds.width);
                maxY = Math.max(maxY, bounds.top + bounds.height);
            });
            const contentWidth = maxX - minX + 20;  
            const contentHeight = maxY - minY + 20;
            const scale = Math.min(800 / contentWidth, 1);
            return { width: contentWidth * scale, height: contentHeight * scale };
        }

        document.getElementById('save-btn').addEventListener('click', () => {
            const originalWidth = canvas.width;
            const originalHeight = canvas.height;

            const { width: newWidth, height: newHeight } = getContentBounds();  

            const scaleX = newWidth / originalWidth;
            const scaleY = newHeight / originalHeight;
            canvas.getObjects().forEach(obj => {
                obj.scaleX *= scaleX;
                obj.scaleY *= scaleY;
                obj.left *= scaleX;
                obj.top *= scaleY;
            });
            canvas.setDimensions({ width: newWidth, height: newHeight });
            canvas.renderAll();

            const restoreData = prepareForSave();

            const link = document.createElement('a');
            link.download = `pagina-${currentPage + 1}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();

            restoreAfterSave(restoreData);

            canvas.getObjects().forEach(obj => {
                obj.scaleX /= scaleX;
                obj.scaleY /= scaleY;
                obj.left /= scaleX;
                obj.top /= scaleY;
            });
            canvas.setDimensions({ width: originalWidth, height: originalHeight });
            canvas.renderAll();

            updateState();
        });

        function toggleSelected(property, onValue, offValue) {
            const activeObject = canvas.getActiveObject();
            if (activeObject && (activeObject.type === 'i-text' || activeObject.type === 'textbox')) {
                const current = activeObject.get(property);
                activeObject.set(property, current === onValue ? offValue : onValue);
                canvas.renderAll();
                updateState();
            }
        }

        document.addEventListener('keydown', (e) => {
            const active = canvas.getActiveObject();
            if ((e.key === 'Delete' || e.key === 'Backspace') && active && !active.isEditing) {
                if (active.type === 'activeSelection') {
                    active.forEachObject((obj) => canvas.remove(obj));
                    canvas.discardActiveObject();
                } else {
                    canvas.remove(active);
                }
                updateState();
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 'z') {
                document.getElementById('undo-btn').click();
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 'c' && active) {
                active.clone((cloned) => copiedObject = cloned);
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 'v' && copiedObject) {
                copiedObject.clone((cloned) => {
                    cloned.set({ left: cloned.left + 10, top: cloned.top + 10 });
                    canvas.add(cloned);
                    canvas.setActiveObject(cloned);
                    updateState();
                });
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 's') {
                document.getElementById('save-btn').click();
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 'n') {
                document.getElementById('new-page-btn').click();
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 'b') {
                toggleSelected('fontWeight', 'bold', 'normal');
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 'i') {
                toggleSelected('fontStyle', 'italic', 'normal');
                e.preventDefault();
            }
            if (e.ctrlKey && e.key === 'u') {
                toggleSelected('underline', true, false);
                e.preventDefault();
            }
        });

        canvas.on('mouse:dblclick', (opt) => {
            if (opt.target && (opt.target.type === 'i-text' || opt.target.type === 'textbox')) opt.target.enterEditing();
        });

        document.getElementById('eyedropper-btn').addEventListener('click', () => {
            currentMode = 'eyedropper';
            canvas.isDrawingMode = false;
            activateButton(document.getElementById('eyedropper-btn'));
        });

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        document.getElementById('paint-bucket-btn').addEventListener('click', () => {
            currentMode = 'paint-bucket';
            canvas.isDrawingMode = false;
            activateButton(document.getElementById('paint-bucket-btn'));
        });

        document.getElementById('image-btn').addEventListener('click', () => {
            document.getElementById('image-upload').click();
        });

        document.getElementById('image-upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (f) => {
                    fabric.Image.fromURL(f.target.result, (img) => {
                        img.set({ left: 100, top: 100, scaleX: 0.5, scaleY: 0.5 });
                        canvas.add(img);
                        updateState();
                        currentMode = 'select';
                        activateButton(document.getElementById('select-btn'));
                    });
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('bg-image-btn').addEventListener('click', () => {
            document.getElementById('bg-image-upload').click();
        });

        document.getElementById('bg-image-upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (f) => {
                    fabric.Image.fromURL(f.target.result, (img) => {
                        canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                            scaleX: canvas.width / img.width,
                            scaleY: canvas.height / img.height
                        });
                        pages[currentPage].bgImage = f.target.result;
                        updateState();
                        currentMode = 'select';
                        activateButton(document.getElementById('select-btn'));
                    });
                };
                reader.readAsDataURL(file);
            }
        });

        function activateButton(button) {
            document.querySelectorAll('#sidebar button').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        }

        activateButton(document.getElementById('select-btn'));
        regenerateLines();
    </script>

</body>
</html>
